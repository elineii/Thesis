# --------------------------
# Некоторые теоретические выкладки
# --------------------------
# y_1* ~ b_10 + b_11 * x_11 + b_12 * x_12 + b_13 * x_13
# y_2* ~ b_20 + b_21 * x_21 + b_22 * x_22 + b_23 * x_23
# y_3* ~ b_30 + b_31 * x_31 + b_32 * x_32 + b_33 * x_33

# Индивид выбирает одну из трех альтернатив:
# y = 1, if y_1* > y_2* & y_1* > y_3*
# y = 2, if y_2* > y_1* & y_2* > y_3*
# y = 3, if y_3* > y_1* & y_3* > y_2*

# Предположение: ошибки имеют многомерное нормальное распределение:
#
#       |e_1i|     ||0|  |σ_1^2           ρ_{12}*σ_1*σ_2  ρ_{13}*σ_1*σ_2||
# e_i = |e_2i| ~ N ||0|, |ρ_{12}*σ_1*σ_2  σ_2^2           ρ_{23}*σ_2*σ_3||
#       |e_3i|     ||0|  |ρ_{13}*σ_1*σ_3  ρ_{23}*σ_2*σ_3  σ_3^2         ||
#
# Полагаем y_3* = 0 (σ_3^2 = 0) и σ_1^2 = 1:
#
#       |e_1i|     ||0|  |1           ρ_{12}*σ_2||
# e_i = |    | ~ N || |, |                      ||
#       |e_2i|     ||0|  |ρ_{12}*σ_2  σ_2^2     ||
#
# А полностью матрицы выглядят так:
#
#       |e_1i|     ||0|  |1           ρ_{12}*σ_2      0||
# e_i = |e_1i| ~ N ||0|, |ρ_{12}*σ_2  σ_2^2           0||
#       |e_3i|     ||0|  |0           0               0||
#
# Вероятности выбора альтернатив вычисляется как:
#
# P(y = 1) = P(1 лучше 2, 1 лучше 3) = 
# = P(xb_1+e_1>xb_2+e2, xb_1+e_1>xb_3+e_3) = P(e_1-e_2>x(b_2-b_1), e_1-e_3>x(b_3-b_1))
#
# |e_1i - e_2i|     ||?|  |?  ?||
# |           | ~ N || |, |    ||
# |e_1i - e_3i|     ||?|  |?  ?||
#
# |1 -1  0| |e_1i|     ||1 -1  0| |0|  |1 -1  0| |1          ρ_{12}*σ_2 0| |1 -1  0|T|
# |       | |e_2i| ~ N ||       | |0|, |       | |ρ_{12}*σ_2 σ_2^2      0| |       | |
# |1  0 -1| |e_3i|     ||1  0 -1| |0|  |1  0 -1| |0          0          0| |1  0 -1| |
#
# |e_1i - e_2i|     
# |           | ~ N (0, Sigma_1)
# |e_1i - e_3i|     
#
#                   |e_1i - e_2i|
# Sigma_1 ** (-1/2) |           | ~ N (0, I)
#                   |e_1i - e_3i|
#
#
# P(y = 2) = P(2 лучше 1, 2 лучше 3) = 
# = P(xb_2+e_2>xb_1+e1, xb_2+e_2>xb_3+e_3) = P(e_2-e_1>x(b_1-b_2), e_2-e_3>x(b_3-b_2))
#
# |e_2i - e_1i|     ||?|  |?  ?||
# |           | ~ N || |, |    ||
# |e_2i - e_3i|     ||?|  |?  ?||
#
# |-1 1  0| |e_1i|     ||-1 1  0| |0|  |-1 1  0| |1          ρ_{12}*σ_2 0| |-1 1  0|T|
# |       | |e_2i| ~ N ||       | |0|, |       | |ρ_{12}*σ_2 σ_2^2      0| |       | |
# | 0 1 -1| |e_3i|     || 0 1 -1| |0|  | 0 1 -1| |0          0          0| | 0 1 -1| |
#
# |e_2i - e_1i|     
# |           | ~ N (0, Sigma_2)
# |e_2i - e_3i|     
#
#                   |e_2i - e_1i|
# Sigma_2 ** (-1/2) |           | ~ N (0, I)
#                   |e_2i - e_3i|
#
#
# P(y = 3) = P(3 лучше 1, 3 лучше 1) = 
# = P(xb_3+e_3>xb_1+e1, xb_3+e_3>xb_2+e_2) = P(e_3-e_1>x(b_1-b_3), e_3-e_2>x(b_2-b_3))
#
# |e_3i - e_1i|     ||?|  |?  ?||
# |           | ~ N || |, |    ||
# |e_3i - e_2i|     ||?|  |?  ?||
#
# |-1  0 1| |e_1i|     ||-1  0 1| |0|  |-1  0 1| |1          ρ_{12}*σ_2 0| |-1  0 1|T|
# |       | |e_2i| ~ N ||       | |0|, |       | |ρ_{12}*σ_2 σ_2^2      0| |       | |
# | 0 -1 1| |e_3i|     || 0 -1 1| |0|  | 0 -1 1| |0          0          0| | 0 -1 1| |
#
# |e_3i - e_1i|     
# |           | ~ N (0, Sigma_3)
# |e_3i - e_2i|     
#
#                   |e_3i - e_1i|
# Sigma_3 ** (-1/2) |           | ~ N (0, I)
#                   |e_3i - e_2i|
